>[!question] Zielstellung:
> In diesem Praktikum erweitern Sie Ihr Verständnis zur Schlüsselverwaltung im Arbeits- speicher anhand von Krypto-Containern. Zu diesem Zweck wird exemplarisch der RAM einer Windows- VM gesichert und der Master-Key eines TrueCrypt- bzw. eines VeraCrypt-Containers ausgelesen.
#### Grundlagen
>[!abstract]
> Bei der Verwendung von verschlüsselten Containern oder Laufwerken in einem System erfolgt die Ver- und Entschlüsselung in der Regel über ein vom Nutzer gewähltes Passwort. Dieses Passwortdient jedoch nicht direkt als Eingabewert für die kryptografischen Algorithmen, sondern schützt einen speziell generierten, deutlich komplexeren Hauptschlüssel (Master-Key). 
> 
> Das Nutzerpasswort fungiert  somit als Schutzmechanismus für diesen Master-Key. Sobald der Zugriff auf das verschlüsselte Medium angefordert wird, fordert das System einmalig1 das Passwort an, um den Master-Key zu entschlüsseln. Der entschlüsselte Schlüssel verbleibt anschließend im Hauptspeicher, damit kryptografische Operationen auf dem Medium ohne wiederholte Passwortabfragen ausgeführt werden können. 
> 
> TrueCrypt ist eine quelloffene Software zur Erstellung und Verwaltung verschlüsselter Speichermedien. Die kryptografischen Operationen werden transparent direkt beim Lesen und Schreiben von Daten durchgeführt, was eine praktikable und weit verbreitete Methode darstellt, sensible Informationen sicher abzulegen. Die Entwicklung von TrueCrypt wurde 2014 bzw. 2016 eingestellt und in Form des Forks VeraCrypt weitergeführt. Die Grundarchitektur beider Projekte ist vielfach vergleichbar – VeraCrypt ergänzt diese jedoch um erhöhte Sicherheitsparameter, zusätzliche Algorithmen und zahlreiche Fehlerbehebungen. Da beide Projekte Open Source sind, lassen sich interne Datenstrukturen und Implementierungsdetails aus dem Quellcode entnehmen und für die forensische Analyse nutzen. 
> 
> Eine häufig genutzte Funktion der genannten Tools ist die Verwendung verschlüsselter Container, in denen vollständige Dateisysteme eingebettet sind. Neben regulären Containern besteht die Möglichkeit, sogenannte versteckte Container anzulegen, die mit einem separaten Passwort geöffnet werden und alternative Daten enthalten. Dieses Konzept dient der glaubhaften Abstreitbarkeit (engl. plausible deniability): Unter äußerem Druck können vorbereitete, unkritische Daten offengelegt werden, während die eigentlichen sensiblen Informationen verborgen bleiben. 
> 
> Bei der Entsperrung eines Containers wird das eingegebene Passwort sequentiell auf beide potenziellen Speicherbereiche angewendet. Zur Überprüfung einer erfolgreichen Entschlüsselung prüft das System auf die korrekte Darstellung einer vier Byte langen ASCII-Zeichenkette (TRUE für TrueCrypt bzw. VERA für VeraCrypt). Für den Anwender äußert sich das Ergebnis ausschließlich darin, ob der Container geöffnet werden kann oder nicht. Es erfolgt keine erkennbare Rückmeldung darüber, ob es sich um einen regulären oder einen versteckten Datensatz handelt.
> 
>Eine Container-Datei besitzt einen standardisierten Aufbau, der schematisch in Abbildung 1 dargestellt ist. Sie beginnt stets mit dem Volume-Header des normalen Containers, gefolgt vom Volume-Header des versteckten Containers (oder zufälligen Daten, sofern kein versteckter Container existiert) sowie dem anschließenden Datenbereich. Am Ende der Datei befinden sich Sicherheitskopien beider Volume-Header. Unabhängig davon, ob es sich um einen normalen oder einen versteckten Container handelt, besteht jeder Volume-Header aus einem 64 Bytes großen, unverschlüsselten Salt-Wert, gefolgt von den verschlüsselten restlichen Header-Daten. Diese sind mit dem Header-Passwort (der Nutzereingabe) verschlüsselt und enthalten unter anderem den Master-Key, der zur eigentlichen Entschlüsselung des Datenbereichs benötigt wird. Hinweis: Dieses Layout bezieht sich ausschließlich auf die Container-Datei im Dateisystem, nicht auf deren Abbildung im Hauptspeicher.
>
>![[Pasted image 20251125124740.png]]
>
>Solange ein Container geöffnet ist, befindet sich der zugehörige Master-Key im Hauptspeicher und kann während dieser Zeit ausgelesen werden. Das Nutzerpasswort verliert in diesem Zustand seine Bedeutung für den Zugriff auf die verschlüsselten Daten. Die Strukturen der im Hauptspeicher abgelegten kryptografischen Informationen von TrueCrypt und VeraCrypt sind auszugsweise in Tabelle 1 dargestellt.
>
>![[Pasted image 20251125124917.png]]
>
>Bei der Erstellung eines Containers kann festgelegt werden, ob ein einzelnes Verschlüsselungsverfahren verwendet oder mehrere Verfahren hintereinander ausgeführt werden sollen (Verschlüsselungskaskade). Die dafür erforderlichen primären und sekundären Schlüsselwerte bilden gemeinsam den Master-Key. Dessen Struktur variiert je nach Anzahl der eingesetzten Verschlüsselungsverfahren. Ein exemplarischer Aufbau eines Master-Keys ist in Tabelle 2 dargestellt.
>
>Es ist möglich, eine Kaskade aus einem, zwei oder drei Algorithmen zu verwenden. Im Master-Key (256 Bytes) werden zunächst alle primären Schlüsselwerte (jeweils 32 Bytes) und anschließend alle sekundären Schlüsselwerte (ebenfalls jeweils 32 Bytes) gespeichert. Die Reihenfolge der einzelnen Schlüssel ist dabei umgekehrt, das heißt: Schlüssel 2 wird vor Schlüssel 1 abgelegt. Nicht genutzte Bytes werden als Füllbytes mit 0x00 belegt.
>
>![[Pasted image 20251125125756.png]]
>
>Für primäre P und sekundäre Schlüssel S ergeben sich somit die folgenden möglichen Reihenfolgen: P1S1, P2P1S2S1 und P3P2P1S3S2S1. Die Bezeichnungen „Primär“ und „Sekundär“ beziehen sich auf interne Komponenten des jeweiligen Verschlüsselungsverfahrens (z. B. Initialisierungsvektor, Runden-
schlüssel oder Teilschlüssel) und müssen an dieser Stelle nicht weiter betrachtet werden.
Sobald ein Master-Key im Hauptspeicher identifiziert wurde, lassen sich die einzelnen Schlüsselwerte
in folgenden Schritten extrahieren:
• Entfernen der Füllbytes aus dem Master-Key (256 Bytes)
• Halbierung des Master-Keys in den vorderen (primären) und hinteren (sekundären) Schlüsselteil
• Zerlegung der Schlüsselteile in Blöcke zu je 32 Bytes
• Nummerierung, Abzählung und Zuordnung der primären und sekundären Schlüsselwertes