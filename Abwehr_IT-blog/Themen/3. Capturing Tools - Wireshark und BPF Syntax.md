>[!info] **Überblick über Paketerfassungswerkzeuge**
Die Erfassung von Netzwerkpaketen ist eine zentrale Aufgabe in der Netzwerkforensik. Neben Hardware-Sniffern stehen verschiedene Softwaretools zur Verfügung:
 >
 >**tcpdump**
 >- Leistungsstarker Analysator für Netzwerkdatenpakete.
 >- Arbeitet mit der `libpcap`-Bibliothek.
 >- Beispiel für das Speichern von Paketen:
  `tcpdump -i eth0 -w dump.pcap` 
  >
>**dumpcap**
>- Teil der Wireshark-Suite und auf effiziente Paketerfassung spezialisiert.
>- Unterstützt `.pcap` und `.pcapng` als Ausgabeformate.
>- Beispiel:
  `dumpcap -i eth0 -w dump.pcapng`
>
>Beide Tools verwenden die **Berkeley Packet Filter (BPF) Syntax**, um den Netzwerkverkehr während der Erfassung zu filtern.
>- Bsp.: HTTP-Traffic einer Quelle auf Port 80:`tcpdump src 192.168.2.3 and tcp port 80`

>[!abstract] **Mustererkennung mit ngrep**
>Zu den wichtigsten Aufgaben innerhalb in der Netzwerkforensik zählt die Erkennung von Eindringlingen bzw. die Suche nach bestimmten Mustern im Netzwerkverkehr. Hierfür stellen Analyseumgebungen wie Wireshark oder ein IDS wie Snort eine Vielzahl an Funktionen bereit. Mitunter kann aber ein einfacheres, weniger komplexes Werkzeug den Job besser und vor allem schneller erledigen.
>#### **ngrep**
>- Erkennung bestimmter Muster in Netzwerkpaketen.
>- Basiert ebenfalls auf der `libpcap`-Bibliothek.
>- Unterstützt Echtzeit-Monitoring und die Analyse gespeicherter `.pcap`-Dateien.
>#### **Beispiel für Mustersuche**
>- Suche nach "pass" oder "USER" auf  Port 80:`ngrep -q -d eth0 -W byline -O output.pcap -wi "pass | USER" port 80`
>
>Parameter:
>- `NIC`: Netzwerkschnittstelle (z. B. `eth0`).
>- `-W`: Zeilenweise Ausgabe.
>- `-i`: Groß-/Kleinschreibung ignorieren.
>- `-O`: Speichert die Ausgabe in einer `.pcap`-Datei.

>[!example] #### **Wireshark – Analyse von Netzwerkverkehr**
>Wireshark ist der Standard für die grafische Netzwerkforensik. Es bietet eine umfassende Suite für die Analyse und Darstellung von Netzwerkverkehr.
>- Unterstützt detaillierte Analysen auf ISO/OSI-Schichten.
>
>#### **Bestandteile der Suite**
>- **Wireshark (GUI):** Grafische Benutzeroberfläche für detaillierte Analysen.
>- **tshark:** Befehlszeilenanalysator -> zum skripten.
>- **dumpcap:** Backend für die Paketerfassung.
>- ...
>
> #### **Vorteile**
> - **Filtermöglichkeiten:**
> 	- **Capture Filters (BPF-Syntax):** Filtern während der Erfassung.
> 	- **Display Filters:** Nachträgliche Filterung in der Anzeige.
> - **Erweiterte Features:**
> 	- Anzeige von Zeitstempeln, Metadaten und GeoIP-Informationen.
> 	- Streamzusammenstellung (z. B. TCP, HTTP).
> 	- Extraktion von Objekten (z. B. Dateien aus HTTP/FTP).
> 	- Entschlüsselung bei bekanntem Schlüssel.
> - **Statistiken und Graphen:**
> 	- Flow Graphen: `Statistiken > Flow Graph`.
> 	- I/O Graphen: `Statistiken > I/O Graph`.
> - **GeoLocation:**
> 	- GeoIP Datenbank von Maxmind `Menu > Statistiken > Endpunkte`
> - **Extrahieren von HTTP und SMB-Objekten:**
> 	- `Menu > Datei > Objekte Exportieren > {HTTP,SMB}`
> - Experteninformation
> 	- `Menu > Analyse > Experteninformation`
>
>#### **Beispiele für Filter**
>
>#### Capture Filter (BPF-Syntax):
>1. Nur ARP-Pakete: `eth.type == 0x0806`
>2. Pakete von oder zu einer IP-Adresse: `ip.host == 141.55.225.210`
>
>>[!table] BASIC CAPTURE FILTER SYNTAX
>>Syntax | Example | Description
>>-- | -- | --
>>host (host) | host 10.10.10.10 | host is either the ip address or host name
>>src host (host) | src host 10.10.10.10 | Capture all packets where host is the source
>>dst host (host) | dst host 10.10.10.10 | Capture all packets where host is the destination
>>port (port) | Port 80 | -"- port is either the source or destination
>>src port (port) | src port 80 | -"- port is the source
>>dst  port (port) | dst port 80 | -"- port is the destination
>>net (net) | Net 192.168.1.0/24 | Capture all packets to/from net
>>src net (net) | src Net 192.168.1.0/24 | -"- net is the source
>>dst net (net) | dst Net 192.168.1.0/24 | -"- net ist destenation
>
>#### Display Filter:
>
>>[!table] BASIC DISPLAY FILTER SYNTAX
>>Shortcut | C-Like | Description | Example
>>-- | -- | -- | -- 
>>eq | == | Equal | IP.src == 10.1.1.5
>>ne | != | Not equal | IP.src != 10.1.1.5
>>gt | > | Greater than | Frame.len > 64
>>lt | < | Less than | Frame.len < 1518
>>ge | >= | Grater then or equal to | Frame.len ge 0x100
>>le | <= | Less than or equal to | Frame.len <= 0x20
>>
>>Sie können ganze Zahlen als Dezimal-, Oktal- oder Hexadezimalzahl ausdrücken. Die folgenden Anzeigefilter sind gleichwertig:
>>- Decimal: `ip.len le 1500`
>>- Octal: ip.len le o2734
>>- Hexadecimal: ip.len le 0x5DC
>>
>>![[Pasted image 20251023182556.png]]
>
>- TCP-Traffic auf Port 25: `tcp.port == 25`
>- HTTP oder SSL Pakete: `http || ssl`
>weitere Beispiele:
>
>- `tcp.port eq 25 or icmp` -> zeigt tcp mit port 25 oder icmp
>- `ip.src == 192.168.8.0/24 and ip.dst == 192.168.0.0/16` -> zeigt Quell-ip und Ziel-ip
>- `eth.addr [0:3] == 00:06:5B` -> Filtert Pakete, bei denen die ersten 3 Bytes der Ethernet-MAC-Adresse **00:06:5B** sind 
>- `udp contains 81:60:03` -> Zeigt UDP-Pakete, die die Hexadezimalwerte **81:60:03** im Payload enthalten
>- `http.request.uri` -> Zeigt alle HTTP-Pakete, die eine **URI (Uniform Resource Identifier)** enthalten
>- `ip.addr == 10.1.2.3` -> Zeigt alle Verbindungen mit dieser IP an
>- `ip.addr != 10.2.3.4 or ip.dst != 10.6.7.9` -> Zeigt Pakete, bei denen die IP-Adresse **10.1.2.3** entweder Quelle oder Ziel ist
>- `!(ip.src == 10.11.12.13)` -> Schließt Pakete aus, die von der Quell-IP-Adresse **10.11.12.13** stammen.
>- offene tcp Ports anzeigen: `tcp.flags.ack == 1 && tcp.flags.syn == 1`
>
>- `eth.type == 0x0806` -> zeigt nur ARP-Pakete 
>- `eth.type == 0x800` -> zeigt ipv4
>- `ip.host == 141.55.225.210` -> zeigt nur Pakete mit Ziel oder Quell ip
>- `eth.addr == 00:00:5e:00:53:00` -> nur Pakete mit MAC
>
>- `arp.duplicate-address-detected` -> ARP Poisoning
>- `eth.src_not_group` -> MAC Flooding 
>
>- `(!(eth.dst[0]&1) && !eth.dst==FF:FF:FF:FF:FF:FF)` -> zeigt nur Unicast an
>
>#### **Unterschiede und Synergien**
>- **tcpdump/dumpcap:** Effiziente Datenerfassung, ideal für große Netzwerke.
>- **Wireshark:** Detaillierte grafische Analyse von gespeicherten Daten.
>- **ngrep:** Zielgerichtete Suche nach Mustern in Echtzeit oder gespeicherten Daten.
>
>#### **Zusammenfassung**
>- Die Paketerfassung und Analyse wird durch Tools wie `tcpdump`, `dumpcap`, `ngrep` und Wireshark ermöglicht.
>- **Wireshark** kombiniert detaillierte Analysen mit benutzerfreundlicher Visualisierung.
>- Die Nutzung von **Filtern** (BPF oder Display) ist essenziell, um relevante Daten gezielt zu extrahieren und zu analysieren
>- BNF-Syntax: https://biot.com/capstats/bpf.html
