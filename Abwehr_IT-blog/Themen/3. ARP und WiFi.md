>[!abstract] **Switches aktiv Abhören:**
>CAM-Tabelle hat begrenzte Speicherfähigkeit -> begrenzte Anzahl MAC-Adressen. Speicher voll können keine neuen Adressen aufgenommen werden. deshalb **FailOpen-Modus**. -> bei überlastung verhält sich **Switch** wie **Hub** -> erlaubt den gesamten Datenverkehr aufzuzeichen.
>
>Realisierbar: duchr Versenden großer anzahl an Paketen mit unterschiedlicher Quell-MAC-Adressen. -> <mark style="background: #BBFABBA6;">MAC-FLOODING</mark>
>verhindern mit: 
>- **Port-Sicherheit:** Anzahl der MAC-Adressen begrenzt 
>-  **Authent. mit AAA-Servern:** Authentifizierung der erkannten MAC-Adressen anhand eines Authentifizierungs-, Autorisierungs- und Abrechnungsservers (AAA-Server) um diese Adressen zu filtern.
>- **MAC-Filter:** Sicherheitsmaßnahmen zum Verhindern von ARP-Spoofing oder IP-Spoofing können in einigen Fällen auch eine zusätzliche MAC-Adressfilterung für Unicast-Pakete durchführen.

>[!info] #### Address Resolution Protocol - ARP
>In Ethernet-Netzwerken wird eine Verbindung folgendermaßen aufgebaut:
>1.  **MAC-Adressen:**
>- Jedes Gerät hat eine eindeutige **MAC-Adresse** (Hardware-Adresse), die zur Identifikation im lokalen Netzwerk dient.
>
>1. **ARP (Address Resolution Protocol):**
>- Wird verwendet, um die **MAC-Adresse** eines Geräts zu ermitteln, wenn nur die **IP-Adresse** bekannt ist.
>- Beispiel: Möchte eine Station im Netzwerk an eine bestimmte IP-Adresse ein Paket senden, muss sie zunächst anhand der Subnetzmaske feststellen, ob es sich um eine IP-Adresse im eigenen Subnetz oder in einem fremden Netz handelt. Befindet sich das Ziel im eigenen Subnetz, prüft der Sender, ob er die passende MAC-Adresse in seinem Cache hat. Ist dies nicht der Fall, sendet er per Address Resolution Protocol (ARP-Request) eine Anfrage mit der IP-Adresse des Ziels. Alle Stationen eines Subnetzes empfangen diese Anfrage. Ein Ethernet-Frame welches als Broadcast versendet wird hat im Ethernet-Header die Ziel-MAC-Adresse FF:FF:FF:FF:FF:FF. Stimmt die IP-Adresse des Broadcast Empfängers mit der eigenen überein, sendet die Station eine ARP-Antwort (ARP-Reply) mit der eigenen MAC-Adresse an den Sender der Anfrage. Dieser kann nun die Hardwareadresse in seinem Cache speichern und Pakete auf Layer 2 passend adressieren. Der Datenaustausch zwischen den beiden Stationen ist möglich.
>- Ist der Zielrechner nicht im gleichen Subnetz, verwendet der Sender die IP-Adresse des Default-Gateways. Existiert zu dieser IP-Adresse ein Eintrag im Cache, schickt er das Paket direkt an den Router. Ist kein Eintrag vorhanden, muss er zuvor per ARP-Anfrage die MAC-Adresse des Routers ermitteln. Der Router ist nach der Zustellung des Pakets durch den Sender für die weitere Zustellung des Datenpakets verantwortlich und kann es an einen anderen Router oder an eine Station eines angeschlossenen Subnetzes verschicken.
>- Nummer 0x0806 (2054) ist für ARP vorgesehen 
>
>1. **Datenübertragung:**
>- Sobald die MAC-Adresse bekannt ist, werden die Daten über **Ethernet-Frames** an das Zielgerät gesendet.
>- ARP ermöglicht Ermittlung;: IP -> MAC-Adresse
>- wird anschließend im ARP-Cache gespeichert
>- RARP(Reverse Address Resolution Protocol) Ermittlung: MAC-Adresse -> IP
>
![[Pasted image 20250111171206.png]]
>
 >>[!danger] ARP-Spoofing, Mitm
 >>Manipulation des ARP-Caches durch gefälschte ARP-Replys, auch ohne vorherige ARP-Requests.
 >>- Ermöglicht es dem Gateway einen ARP-Eintrag einzuschleusen, der die MAC-Adresse des Angreifers mit der IP-Adresse eines Gerätes im LAN in Verbindung bringt.
>>- Ermöglicht dem Angreifer als Gateway oder Zielgerät aufzutreten..
>>- Angreifer muss Datenpakete weiterleiten, sodass beim Opfer eine funktionierende Internetverbindung möglich ist
>>
>>![[Pasted image 20241204163322.png]]
>>
>>#### ARP-Flooding, Do Angriff
>>
>>Es ist ebenfalls Möglich zur IP des Opfers beim Gateway auch die Broadcast MAC zu hinterlegen, damit jedes Frame im LAN abgegriffen werden kann -> Netzwerkkarte in promiscous mode (freizügiger modus).
>>
>>**Angriffsvarianten**
>>- **ARP Request Flood:** Überlastung des ARP-Caches mit gefälschten Anfragen.
>>- **ARP Response Flood:** Angreifer geben vor, das Subnetz-Gateway oder ein Host im Subnetz zu sein, und senden eine falsche MAC-Adresse aus, wodurch alle Geräte im Subnetz die falsche MAC-Adresse speichern. Infolgedessen können Geräte im Subnetz nicht mit dem Subnetz-Gateway oder -Host kommunizieren.

>[!abstract] #### **Datenüberwachung in Drahtlosenetzwerken (WiFi)**
>- **Möglichkeiten Datenverkehr im WLAN mitzuschneiden:**
>	- **Aktiver Modus:** aktive Teilnahme am WLAN, Empfang von Paketen an den einzelnen Teilnehmer
>	- **Monitor-Modus:** passives Mitschneiden aller WIFI Signale. (vollständig passiv)
>	- **Promiscuous-Modus:** Empfang aller Datenpakete trotz Adressierung.
>- **Tools:** Wireshark, Aircrack-ng.
>
>- Möglichleiken Mobilfunkverkehr mitzuschneiden:
>	- IMSI Catcher
>	- Software-Defined Radios (SDR) (Für generelle Überwachung von mobil Funkfrequenzen)
>		- z.b HackRF One
>		![[Pasted image 20251014170011.png]]
>
>**WLAN-Beacons**
>In der Funktechnik sind "Beacons" allgemeine Informations- und Management-Pakete mit Identifikationsdaten, die Basisstationen regelmäßig aussenden, über ihre Anwesenheit informieren. WLAN-Basisstationen bzw. Access Points senden Beacons aus, um WLAN-Clients ihre Connectivity anzubieten. Ist das WLAN einem Client bereits bekannt meldet er sich automatisch an. Kennt der Client das WLAN nicht, dann informiert er seinen Nutzer mit einem aufpoppenden Info-Fenster auf seinem Smartphone, Notebook oder Tablet über dieses neue WLAN. Wie oft ein WLAN-Access-Point seine Beacons verschickt (Intervall), hängt von dessen Konfiguration ab. Es gibt Geräte, die verschicken einen Beacon alle 100 ms.
>
>**Aktives WLAN-Sniffing**
>Um WLAN-Access Points ausfindig zu machen muss nicht auf die Beacons gewartet werden, sondern man kann aktiv Sniffen. Zu dieser Kategorie gehört der recht verbreitete **NetStumbler**, der vor allem auf Windows-Systemen genutzt wird. Aktive WLAN-Sniffer senden sogenannte **Probe-Request-Pakete** an den Access Point, welcher daraufhin mit einem **Probe-Response-Paket** antwortet. Es findet also eine explizite Abfrage an den Access Points statt. Arbeitsweise: Der Sniffer sendet auf jedem Kanal den Request und jeder Access-Point, der diesen empfangen kann, antwortet im aktuellen WLAN-Kanal mit einem Response mit dem Netzwerknamen (SSID) und Informationen zur Authentifizierung und Verschlüsselung.
>
>**Passives WLAN Sniffing**
>>[!tip] Verstecken von WLAN - Network cloaking:
>>Es ist möglich den Netzwerknamen (die SSID) zu maskieren und nicht öffentlich zu machen (Hidden SSIDs). Die meisten Router bieten diese Option an.
>Bietet nur eine scheinbare Sicherheit. Die SSID wird dennoch in vielen Netzwerkpaketen im Klartext übertragen und lässt sich so durch passives lauschen zuordnen. Über KisMAC, Kismet, inSSIDer
>
>**Angriffe auf WLAN/WiFi Verbindungen**
>>[!tip] Aircrack-ng
>>Aircrack-ng ist eine Sammlung von Computerprogrammen, die es ermöglichen, Schwachstellen in WLANs auszunutzen und zu analysieren. Der Name des Hauptprogrammes zum Berechnen der Schlüssel ist aircrack-ng. Anwendungsmöglichkeiten sind zum Beispiel das Mitschneiden von Datenpaketen eines Netzwerks oder das Berechnen von WEP, WPA oder WPA2-Schlüsseln.
>- **aircrack-ng** - berechnet WEP- (Brute-force-) und WPA-Schlüssel (Wörterbuchattacke)
>- **airodump-ng** - Paket-Sniffer: Zeichnet Datenverkehr in PCAP- oder IVs-Dateien auf und zeigt Informationen über Netzwerke
>- **aireplay-ng** - schleust selbst erzeugte Pakete in Netzwerke ein
>- **airdecap-ng** - entschlüsselt aufgezeichnete verschlüsselte WEP- oder WPA-Daten mittels eines bereits bekannten Schlüssels
>- **airmon-ng** - versetzt WLAN-Karten unter Linux in den Monitor-Modus
>
 >**Absicherung von WLAN Geräten**
 >>[!tip] MAC-Filter
 >>Ein MAC-Filter ist ein Netzwerk-Zugangsschutz, der nur Geräten mit bestimmter MAC-Adresse Zugang zum Netzwerk gestattet. Typischerweise wird ein MAC-Filter in Form einer Tabelle im Router (Firewall) abgelegt. Ein MAC-Filter gilt aus verschiedenen Gründen als ein sicherheits-technisch schwacher Zugangsschutz.
 >
 >MAC-Adressen stehen in jedem Paket, die sich passiv mitschneiden lassen!!!
 >
 >**Abmelden von WLAN Clients (Deauthentication)**
 >>[!tip] Deauthentication Aktiver Angriff:
 >>Sendet Pakete aus, die einen oder mehrere Clients von einem spezifischen Accesspoint trennen.
 >>- Angriff auf die Verfügbarkeit
 >>- Auslesen einer versteckten SSID
 >>- Aufnehmen eines WPA/WPA2-Verbindungsvorgangs (4-Way-Handshake) für einen späteren Angriff
 >>- Generieren von ARP-Requests (Windows Clients leeren mitunter ihren ARP- Cache wenn Sie vom Netz getrennt werden)
 >
 >>```bash
 >>aireplay -ng -0 3 -e MySecretWiFi ifwlan01 02:19:14 Sending DeAuth to broadcast - [A3:81:A6:BE:4C:12]
 >>```
 >
>**WLAN Packet Injection**
>>[!tip] Packet Injection:
>>Mit einer aktiven WLAN Karte lassen sich auch andere Pakete alszur Deauthentication in ein Netz einbringen.
>>
>>Dies kann für:
>>- Man-In-The-Middle Angriffe
>>- Denial-of-Service Angriffe
>>oder ähnliches verwendet werden.
>
>```bash
>aireplay-ng -6 -h 00:09:5B:EC:EE:F2 -b 00:13:10:30:24:9C -D ifwlan01
-6 means Cafe-Latte attack
-h 00:09:5B:EC:EE:F2 is our card MAC address
-b 00:13:10:30:24:9C is the Access Point MAC (any valid MAC should work)
-D disables AP detection.
-ifwlan01 is the wireless interface name
>```
>
>**WEP (Wireless Equivalent Privacy) Cracking**
>Der Angriff auf WEP wurde bereits 2001 von Scott Fluhrer, Itsik Mantin und Adi Shamir veröffentlicht. Die Herausforderung für einen Angreifer war die Aufzeichnung von ca. 1 Million Datenpaketen, die benötigt wurden, um die Verschlüsselung zu knacken. Aktuelle Versionen von aircrack-ng brauchen für einen 128-Bit-Schlüssel in etwa 40.000 Pakete. Eine massive Beschleunigung des Verfahrens erfolgt durch nicht nur passives sniffen nach Datenpaketen, sondern durch aktives in das Netzwerk injizieren. Für einen Angriff auf WEP (ARP Replay Attack) sind folgende Schritte notwendig:
>- Mitlesen und Speichern des Datenverkehrs (Sniffen - airodump)
>- regelmäßiges Assoziieren am Access-Point (Authentication/Deauthentication)
>- Sniffen eines verschlüsselten ARP-Requests eines Clients (airodump/aireplay)
>- massives Senden des mitgelauschten ARP-Requests an den Access-Point (aireplay)
>- Berechnung des Schlüssels (aircrack)
>Der Schlüsselinhalt ist bei WEP vollkommen irrelevant, es gibt keine starken oder schwachen Schlüssel. WEP ist zu 100 % berechenbar. Es sind für den Angriff nur Daten nötig, die der Access-Point versendet. Die Aufzeichnung des Datenverkehrs vom Client zum Access-Point ist nicht nötig.
>
>**WPA/WPA2 (Wi-Fi Protected Access) Cracking**
>Die Sicherheit von WPA und WPA-2 hängt von der Qualität des Schlüssels ab. Die Mindestlänge des Schlüssels wurde auf 8 Zeichen festgelegt. Ein möglicher Angriff auf WPA oder WPA-2 basiert auf dem Erraten des Schlüssels. Ein Angreifer muss dazu den vollständigen Verbindungsaufbau im 4-Wege Handshake zwischen Client und Access-Point mitsniffen (siehe airodmp Beispiel). Dazu ist eine örtliche Nähe zum Netzwerk notwendig, da hierfür auch der Datenverkehr zwischen Client und Access-Point benötigt wird. Hat ein Angreifer den 4-Wege-Handshake aufgezeichnet, kann die weitere Analyse offline erfolgen. Eine Interaktion mit dem Access-Point ist nicht mehr nötig.
>
>```bash
>[CH 8 ][ Elapsed : 24 s ][ WPA handshake : A3:81:A6:BE:4C:12] BSSID #Data , #/s CH MB ENC CIPHER AUTH ESSIDA3:81:A6:BE:4C:12 30 3 8 54e. WPA2 CCMP PSK MySecretWiFi BSSID STATION PWR Frames Probe A3:81:A6:BE:4C:12 2B:11:91: FD:1E:41 -26 116
>```
>
>![[Pasted image 20251017133400.png]]
>![[Pasted image 20251017133431.png]]
>
>**WPA-2 Krackattack**
>Im Oktober 2017 wurden durch die beiden Forscher Mathy Vanhoef und Frank Piessens der University of Leuven ein Angriff auf die WPA2 Verschlüsselung veröffentlicht die KRACK (Key Reinstallation Attack) genannt wird. KRACK deckte keine Schwachstelle im WPA-2- Standard an sich, sondern in vielen Implementierungen dieses Standards auf. Dabei werden einzelne Pakete des WPA-4-Way-Handshakes geblockt, und die verwendete Paketnummerierung wird danach auf Null gesetzt. Anfällige Implementierungen verwenden nun den gleichen Schlüsselteil erneut für den Verbindungsaufbau. Das sollte aber nichtmöglich sein, da nur einmalige Keys erlaubt sind. Bei einigen Linux und Android Versionen wird dabei sogar der Encryption Key genullt! Ein erfolgreicher Angriff mittels KRACK würde dem Angreifer in einer Man-in-the-Middle Position Zugang zu dem verschlüsselten Netzwerk ermöglichen. Das WiFi- Passwort selbst kann dabei nicht ermittelt werden. Weitere Information dazu finden Sie unter https://www.krackattacks.com.
>
>**WPA-2 Enterprise**
>WPA-2 Enterprise nutzt im Gegensatz zu WPA-2 PSK (Pre-Shared Key) für jeden Benutzer eine individuelle Kombination aus Username und Passwort. WPA-2 Enterprise ist unter bestimmten Umständen mit einer Evil-Twin-Attacke angreifbar. Dabei installiert ein Angreifer quasi eine Kopie eines aktiven Access- Points und versucht damit, von einem WLAN-Client, der sich mit dem falschen Netzwerk verbinden will, eine Challenge-Response-Kombination aufzuzeichnen. Es handelt sich allerdings nicht um das Passwort selbst. Ähnlich wie der Angriff auf WPA-2 PSK muss nun das Passwort »erraten« werden. Dazu dienen Passwort-Cracker wie John The Ripper oder Hashcat. Die Ermittlung des Passwortes kann offline erfolgen.
>
>**WPS Angriffe**
>Das WPS (Wireless Protected Setup) ist eine Vereinfachung und Konfigurationshilfe für den Endanwender. Am Access-Point wird ein beliebig langes und komplexes Passwort konfiguriert. Danach generiert der Access-Point eine 8-stellige Zahl (WPS-PIN). Für die Konfiguration am WLAN-Client wird nun nur diese 8-stellige Zahl benötigt. Der Client erhält dann vom Access-Point das eigentliche WPA-2-Passwort über einen verschlüsselten Datenkanal übermittelt. Damit reduziert sich die Sicherheit des Netzwerks auf eine 8-stellige Zahl mit 100 Millionen Möglichkeiten. Der Test einer Zahl dauert etwa 1 bis 2 Sekunden, ein **Brute-Force-Ansatz** würde damit etwa zwischen 3 und 6 Jahre dauern und ist daher für einen Angreifer uninteressant. Das große Problem bei WPS ist ein grober Designfehler im Protokoll für den Datenaustausch zwischen Client und Access-Point: Der Access-Point liefert die Information, ob die ersten vier Stellen der Zahl korrekt sind oder nicht! Damit reduziert sich die Aufgabe auf die Ermittlung einer 4-stelligen Zahl (10.000 Möglichkeiten) für den ersten Teil und einer 3-stelligen Zahl (1.000 Möglichkeiten) für den zweiten Teil, denn die letzte Stelle ist eine Prüfziffer und wird berechnet. Ein Angreifer kann also mit maximal 11.000 Versuchen die WPS- PIN mittels einer **Brute-Force-Attacke** ermitteln. Bei einer durchschnittlichen Antwortzeit von 2 Sekunden sind das ca. 10 Stunden. Die Komplexität des WPA-2-Passwortes hat darauf keinen Einfluss. Die Hersteller haben auf die Problematik reagiert und verschiedene Schutzmaßnahmen implementiert. Ein Mechanismus ist die Einführung einer Maximalanzahl an Fehlversuchen mit anschließender Deaktivierung von WPS oder einem Timeout von einer Minute, bis die nächsten Versuche möglich sind. Es existieren auch WPS Varianten, die WPS nur nach einem Tastendruck am Access-Point für eine bestimmte Zeit aktiviert.
>
>**WiFi-Default Passwörter**
>Hersteller von WiFi-Access-Points stehen vor der Herausforderung, für jedes ausgelieferte Gerät ein individuelles Default-Passwort zu vergeben. Dieses muss im Herstellungsprozess automatisiert gesetzt und entsprechend in der Dokumentation vermerkt werden. Der Hersteller bzw. das Fabrikationsmodell kann entweder über eine spezifische SSID oder die MAC-Adresse des Access-Points ermittelt werden. Wird als Input für die Berechnung des Default-Passworts die MAC-Adresse des Gerätes verwendet und ist der verwendete Algorithmus bekannt, so kann auch ein Angreifer das Default-Passwort errechnen.
>
>**WiFi-Client-Access - Evil Twin Attacke**
>Der folgende Angriff nutzt die z. B. in Mobiltelefonen gespeicherten WLANs aus. Um automatisch eine Verbindung zu gespeicherten Netzen herstellen zu können, sucht der WLAN-Client ständig nach den konfigurierten Netzen. Die Suche erfolgt allerdings aktiv, durch Aussenden von sogenannten Probe Requests. Diese Datenpakete enthalten die SSID des gesuchten Netzwerkes. Ein Angreifer kann die Probe Requests mitlesen und darauf dynamisch einen Access-Point mit der gesuchten SSID starten. Der WLAN-Client wird sich nun automatisch zu dem Access-Point verbinden. Stellt der Angreifer dem Client über das gefälschte Netzwerk eine IP-Adresse, ein Gateway und einen Internetzugang zur Verfügung, so kann er in der Man-in-the-Middle-Position jeglichen Datenverkehr mitlesen. Dies funktioniert jedoch nur mit unverschlüsselten Netzwerken, wie etwa bei Bahn, Flughafen oder in Restaurants genutzt.
>
>**WPA3 - Dragonly Authentication**
>Simultaneous Authentication of Equals, kurz SAE, bildet die Grundlage für ein sicheres Aushandeln des Sitzungsschlüssels zwischen WLAN-Client und Access Point in WPA3.Dabei wird beim WPA3-Handshake das eigentliche Geheimnis nicht mehr über denFunkkanal übertragen, sondern nur das Ergebnis einer Berechnung. Zusätzlich bestätigensich die beteiligen Geräte zeitlich asynchron, dass sie über das gleiche Geheimnis verfügen.Das als "Dragonfly" bezeichnete Verfahren erschwert mittels "Zero-knowledge Proof" dasOffline-Knacken des WLAN-Passworts. Dabei wird verhindert, dass der Angreifer das Passwort herausbekommt, in dem er den WPA3-Handshake mitschneidet und später einen Wörterbuch- oder Brute-Force-Angriff durchführt.Anfang April 2019 demonstrierten die beiden Forscher Mathy Vanhoef (NYUAD) und Eyal Ronen (Tel Aviv University & KU Leuven) in ihrem Paper „Dragonblood: A Security Analysisof WPA3’s SAE Handshake“ mehrere Schwachstellen in WPA3. Zu diesen gehören etwa Downgrade-Attacken, mit denen sich die höheren Sicherheitshürden von WPA3-Personal umgehen lassen.

